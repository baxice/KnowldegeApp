# 更新日志

## [2024-01-XX] - 用户头像下拉菜单功能

### 新增功能 ✨

#### 用户头像组件 (`UserAvatar.vue`)
- **未登录用户界面**
  - 显示"游客"状态和问号头像
  - 下拉菜单包含"登录"和"注册"选项
  - 点击可直接跳转到相应页面

- **已登录用户界面**
  - 显示用户名首字母的彩色渐变头像
  - 显示完整的用户名和邮箱信息
  - 下拉菜单包含：
    - 个人资料（开发中）
    - 设置（开发中）
    - 管理后台（仅管理员）
    - 退出登录（带确认对话框）

#### 主页集成
- 将用户头像组件集成到 `HomePage.vue` 的侧边栏底部
- 替换了原有的静态用户信息展示
- 支持动态认证状态更新

### 改进功能 🔧

#### 认证状态管理
- 同时支持 `authStore` 和 `userStore` 状态管理
- 在页面初始化时自动检查和恢复用户登录状态
- 优化了认证状态的同步机制

#### 样式和交互
- 完全适配项目的 Obsidian 暗色主题
- 添加了悬停效果和过渡动画
- 响应式设计，在移动设备上自动调整布局
- 点击外部区域自动关闭下拉菜单

#### CSS 变量扩展
- 新增 `--color-red` 用于错误和危险操作
- 新增 `--text-muted` 系列变量用于次要文本
- 确保所有样式变量在主题切换时正确更新

### 技术细节 🔧

#### 组件架构
```vue
UserAvatar.vue
├── 头像按钮区域
│   ├── 用户头像（渐变背景）
│   ├── 用户信息（用户名、邮箱）
│   └── 下拉箭头图标
└── 下拉菜单区域
    ├── 菜单头部（用户详细信息）
    ├── 功能菜单项
    └── 退出登录项（特殊样式）
```

#### 状态管理兼容性
- 优先使用 `userStore` （与现有登录页面保持一致）
- 回退支持 `authStore` （向后兼容）
- 自动检测和使用可用的认证方法

#### 响应式断点
- `768px` 以下：隐藏用户信息文本，仅显示头像
- 下拉菜单宽度自动调整
- 确保在各种屏幕尺寸下都有良好的用户体验

### 使用方法 📖

#### 基本使用
```vue
<template>
  <div class="user-info">
    <UserAvatar />
  </div>
</template>

<script setup>
import UserAvatar from '@/components/common/UserAvatar.vue'
</script>
```

#### 在 HomePage.vue 中的集成
```vue
<!-- 替换原有的用户信息展示 -->
<div class="user-info">
  <UserAvatar />
</div>
```

### 依赖要求 📦

- **Element Plus** - 用于消息提示和确认对话框
- **Vue Router** - 用于页面跳转
- **Pinia Store** - 用于状态管理
- **Font Awesome** - 用于图标显示

### 待开发功能 🚧

- [ ] 个人资料页面和编辑功能
- [ ] 用户设置页面
- [ ] 头像图片上传功能
- [ ] 更多的用户偏好设置
- [ ] 用户活动历史记录

### 已知问题 ⚠️

- 个人资料和设置功能目前显示开发中提示
- 需要确保后端 API 与前端认证状态保持同步
- 在某些情况下可能需要手动刷新页面来更新认证状态

### 向后兼容性 ✅

- 完全兼容现有的登录和注册流程
- 不影响现有的认证相关功能
- 可以安全地与现有代码共存 